
  <!DOCTYPE html>
  <html>
    <head>
      <title>UploadContainer.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="..\..\..\..\assets\source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="..\..\..\..\assets\source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="..\..\..\..\index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="negative"><td class="">pages\classification\upload\UploadContainer.tsx</td><td class="">92.34%</td><td class="">99%</td><td class="">261</td><td class="">241</td><td class="">20</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import useAxios from &#x27;axios-hooks&#x27;;
import { useFormik } from &#x27;formik&#x27;;
import { useRouter } from &#x27;next/router&#x27;;
import { useEffect, useState } from &#x27;react&#x27;;
import Api from &#x27;../../../apis/index&#x27;;
import MyModal from &#x27;../../../components/common/Widget/MyModal&#x27;;
import useAlert from &#x27;../../../hooks/useAlert&#x27;;
import UploadView from &#x27;./UploadView&#x27;;

interface UploadContainerProps {
    showUploadSet?: boolean;
    app_function?: string;
    miniapp_tag_id?: string;
    miniapp_form_schema_id?: string;
    miniapp_target_folder_id?: string;
    form_miniapp?: boolean;
}

const apiSetting = new Api();

function UploadContainer(props: UploadContainerProps) {
    const {
        showUploadSet,
        app_function,
        miniapp_tag_id,
        miniapp_form_schema_id,
        miniapp_target_folder_id,
        form_miniapp
    } = props;
    const router = useRouter();
    const { setAlert } = useAlert();
    const [open, setOpen] = useState(false);
    const [documents, setDocuments] = useState([]);
    const [target_folder_id, set_target_folder_id] = useState(miniapp_target_folder_id);
    const [tagId, setTagId] = useState(&#x27;&#x27;);
    const [needAutoUpload, setNeedAutoUpload] = useState(false);
    const [needs_deep_understanding, set_needs_deep_understanding] = useState(false);
    const [needs_approval, set_needs_approval] = useState(false);
    const [form_schema_id, set_form_schema_id] = useState(&#x27;&#x27;);
    const formik = useFormik({
        initialValues: {
            document: []
        },
        onSubmit: (values) =&gt; {
            const formData = new FormData();
            for (const i of documents) {
                formData.append(&#x27;document[]&#x27;, i);
            }
            if (target_folder_id) {
                formData.append(&#x27;target_folder_id&#x27;, target_folder_id);
            }
            // console.log(&#x27;tagId&#x27;, tagId);
            // console.log(&#x27;needAutoUpload&#x27;, needAutoUpload);
            // console.log(&#x27;needs_approval&#x27;, needs_approval);
            // console.log(&#x27;needs_deep_understanding&#x27;, JSON.stringify(needs_deep_understanding));
            // console.log(&#x27;form_schema_id&#x27;, form_schema_id);

            if (&#x27;upload_document&#x27; === app_function) {
                if (miniapp_tag_id) formData.append(&#x27;tag_id&#x27;, miniapp_tag_id);
                uploadByBatchTag({
                    data: formData
                });
            } else if (&#x27;form_understanding&#x27; === app_function) {
                if (miniapp_tag_id) formData.append(&#x27;tag_id&#x27;, miniapp_tag_id);
                formData.append(&#x27;needs_deep_understanding&#x27;, JSON.stringify(true));
                if (miniapp_form_schema_id)
                    formData.append(&#x27;form_schema_id&#x27;, miniapp_form_schema_id);
                uploadByBatchTag({
                    data: formData
                });
            } else if (needAutoUpload) {
                formData.append(&#x27;tag_id&#x27;, tagId);
                formData.append(
                    &#x27;needs_deep_understanding&#x27;,
                    JSON.stringify(needs_deep_understanding)
                );

                if (needs_deep_understanding) {
                    formData.append(&#x27;form_schema_id&#x27;, form_schema_id);
                    formData.append(&#x27;needs_approval&#x27;, JSON.stringify(needs_approval));
                }
                if (!tagId) {
                    setAlert({ title: &#x27;請選擇類別&#x27;, type: &#x27;info&#x27; });
                    return;
                }
                if (needs_deep_understanding &amp;&amp; !form_schema_id) {
                    setAlert({ title: &#x27;請選擇表格深度理解的模型&#x27;, type: &#x27;info&#x27; });
                    return;
                }
                uploadByBatchTag({
                    data: formData
                });
            } else {
                upload({
                    data: formData
                });
            }
        }
    });
    const [
        { data: uploadData, loading: uploadLoading, error: uploadError, response: uploadResponse },
        upload
    ] = useAxios(apiSetting.Storage.upload(), { manual: true });

    const [
        {
            data: uploadByBatchTagData,
            loading: uploadByBatchTagLoading,
            error: uploadByBatchTagError,
            response: uploadByBatchTagResponse
        },
        uploadByBatchTag
    ] = useAxios(apiSetting.Storage.uploadByBatchTag(), { manual: true });

    const [{ data: getAllLabelsData, error: getAllLabelsError }, getAllLabels] = useAxios(
        apiSetting.Tag.getAllTags(),
        { manual: false }
    );

    const [{ data: schemasStatusReadyData }, schemasStatusReady] = useAxios(
        apiSetting.Form.schemasStatusReady(),
        {
            manual: false
        }
    );

    useEffect(() =&gt; {
        if (uploadData &amp;&amp; uploadData.success === true) {
            setOpen(false);
            setVisable(true);
            // router.push(&#x27;/classification/validate&#x27;);
        } else if (uploadData &amp;&amp; uploadData.success === false) {
            setOpen(false);
            setAlert({ title: &#x27;Upload failed! Please try again!&#x27;, type: &#x27;error&#x27; });
        }
    }, [router, uploadData]);

    useEffect(() =&gt; {
        if (uploadByBatchTagData &amp;&amp; uploadByBatchTagData.success === true) {
            setOpen(false);
            setVisable(true);
            // router.push(&#x27;/classification/validate&#x27;);
        } else if (uploadByBatchTagData &amp;&amp; uploadByBatchTagData.success === false) {
            setOpen(false);
            setAlert({ title: &#x27;Upload failed! Please try again!&#x27;, type: &#x27;error&#x27; });
        }
    }, [router, uploadByBatchTagData]);

    useEffect(() =&gt; {
        setOpen(uploadLoading || uploadByBatchTagLoading);
    }, [uploadLoading, uploadByBatchTagLoading]);

    // useEffect(() =&gt; {
    //     console.log(getAllLabelsData);

    // }, [getAllLabelsData]);

    const [visable, setVisable] = useState(false);
    const nextUpload = () =&gt; {
        setVisable(false);
        router.reload();
    };
    const confirm = () =&gt; {
        setVisable(false);
        router.push(&#x27;/classification/logs&#x27;);
    };
    return (
        &lt;&gt;
            &lt;UploadView
                {...{
                    formik,
                    setDocuments,
                    open,
                    setOpen,
                    target_folder_id,
                    set_target_folder_id,
                    setTagId,
                    getAllLabelsData,
                    needAutoUpload,
                    setNeedAutoUpload,
                    needs_deep_understanding,
                    set_needs_deep_understanding,
                    needs_approval,
                    set_needs_approval,
                    form_schema_id,
                    set_form_schema_id,
                    schemasStatusReadyData,
                    showUploadSet,
                    form_miniapp
                }}
            /&gt;
            &lt;MyModal
                visable={visable}
                cancelClick={() =&gt; {
                    form_miniapp ? nextUpload() : confirm();
                }}
                cancelText={form_miniapp ? &#x27;確認&#x27; : &#x27;完成並進行智能分類&#x27;}
                confirmClick={nextUpload}
                confirmText={&#x27;下一批&#x27;}
                success={true}
                description={`已成功上傳  ${documents.length}  份文檔`}
            /&gt;
        &lt;/&gt;
    );
}

export default UploadContainer;
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:100,&quot;character&quot;:16,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:106,&quot;character&quot;:18,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:114,&quot;character&quot;:19,&quot;text&quot;:&quot;getAllLabelsData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:119,&quot;character&quot;:19,&quot;text&quot;:&quot;schemasStatusReadyData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:127,&quot;character&quot;:12,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:127,&quot;character&quot;:26,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:127,&quot;character&quot;:37,&quot;text&quot;:&quot;success&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:131,&quot;character&quot;:19,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:131,&quot;character&quot;:33,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:131,&quot;character&quot;:44,&quot;text&quot;:&quot;success&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:135,&quot;character&quot;:16,&quot;text&quot;:&quot;uploadData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:12,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:36,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:138,&quot;character&quot;:57,&quot;text&quot;:&quot;success&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:19,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:43,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:142,&quot;character&quot;:64,&quot;text&quot;:&quot;success&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:146,&quot;character&quot;:16,&quot;text&quot;:&quot;uploadByBatchTagData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:177,&quot;character&quot;:20,&quot;text&quot;:&quot;getAllLabelsData&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;pages\\classification\\upload\\UploadContainer.tsx&quot;,&quot;line&quot;:186,&quot;character&quot;:20,&quot;text&quot;:&quot;schemasStatusReadyData&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 03 Aug 2023 09:19:42 GMT</p>
    </body>
  </html>
  